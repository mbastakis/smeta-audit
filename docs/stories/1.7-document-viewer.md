# Story 1.7: PDF Viewer and File Download

## Status
**Ready for Review**

## Story
**As an** HR manager,  
**I want** to view PDF files in-browser and download other file types,  
**so that** I can quickly show documents to the auditor without leaving the application.

## Acceptance Criteria
1. Clicking "View" on PDF document opens full-screen modal overlay with embedded PDF viewer (react-pdf component)
2. PDF viewer displays document with zoom controls (+, -, Fit to width), page navigation (previous, next, page X of Y), and close button (X)
3. PDF loads from `/api/documents/:id/download` endpoint
4. Loading state: Shows spinner while PDF renders
5. Error state: If PDF fails to load, shows message "Unable to load document" with "Download" fallback button
6. Clicking "View" on DOCX/XLSX/image opens modal with file icon, filename, size, and "Open in [Default App]" button that triggers download
7. Download button calls `/api/documents/:id/download` which triggers browser download
8. Modal close (X button or ESC key) returns to document list without page reload (maintains scroll position)
9. Keyboard accessibility: ESC closes modal, Tab navigates controls

## Tasks / Subtasks
- [x] Install react-pdf
- [x] Create DocumentViewerModal component
- [x] Implement PDF viewer with controls
- [x] Implement download for non-PDF files
- [x] Add loading and error states
- [x] Implement keyboard navigation
- [x] Test with all file types

## Dev Notes

**IMPORTANT:** No authentication system in this application. The API endpoints are accessible without authentication headers. Only CORS headers are needed in development mode.

---

## Dev Agent Record

### Agent Model Used
Claude 3.7 Sonnet (opencode)

### Debug Log References
None - Implementation completed successfully

### Completion Notes
- Installed react-pdf (v7.5+) and pdfjs-dist dependencies
- Created DocumentViewerModal component with full-screen modal (90vh Ã— 90vw)
- Implemented PDF viewer with zoom controls (+, -, Fit to Width)
- Added page navigation (previous, next, page counter)
- Integrated download functionality for all file types
- PDF documents: Display inline with react-pdf Document and Page components
- Non-PDF documents: Show file icon, name, size, and "Open in Default App" button
- Loading state: Centered spinner with "Loading PDF..." message
- Error state: Error message with "Download Instead" fallback button
- ESC key closes modal (keyboard accessibility)
- Modal preserves scroll position when closed (no page reload)
- Configured PDF.js worker from CDN
- Integrated into PillarView page - View button opens modal
- All tests passing (8/8)

### File List
**New Files Created:**
- `frontend/src/components/documents/DocumentViewerModal.tsx` - Full document viewer modal with PDF rendering
- `frontend/tests/DocumentViewerModal.test.ts` - Basic unit tests for viewer logic

**Modified Files:**
- `frontend/src/pages/PillarView.tsx` - Added DocumentViewerModal integration
- `frontend/package.json` - Added react-pdf and pdfjs-dist dependencies

---

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| Oct 28, 2025 | 1.0 | Story created from PRD | Sarah (PO) |
| Oct 28, 2025 | 1.1 | Removed authentication requirement | Sarah (PO) |
| Oct 28, 2025 | 1.2 | Story implemented - PDF viewer and file download complete | James (Dev) |
