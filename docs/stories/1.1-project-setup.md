# Story 1.1: Project Setup & Hello World

## Status
**Ready for Review**

---

## Story

**As a** developer,  
**I want** a functioning full-stack project structure with backend API and frontend React app,  
**so that** I can begin building features with proper foundation.

---

## Acceptance Criteria

1. Backend Node.js/Express project initialized with package.json and folder structure (routes/, controllers/, database/)
2. Frontend React + Vite project initialized with package.json and folder structure (src/components/, src/services/)
3. Backend health check endpoint (`GET /api/health`) returns `{ status: 'ok' }` and responds within 100ms
4. Frontend displays "SMETA Platform" heading and makes successful API call to health endpoint, displaying connection status
5. SQLite database file created at `data/smeta.db` with connection verified
6. Database schema created: `documents` and `capas` tables with all fields per Technical Assumptions
7. Backend runs on `http://localhost:5000` and frontend dev server runs on `http://localhost:3000` with CORS configured
8. Git repository initialized with `.gitignore` (node_modules, data/*.db, uploads/)
9. README.md contains startup instructions for development mode

---

## Tasks / Subtasks

- [x] Initialize monorepo structure (AC: 1, 2)
  - [x] Create root package.json with npm workspaces
  - [x] Create backend/ folder with Express project structure
  - [x] Create frontend/ folder with Vite + React project
  - [x] Create data/ folder for SQLite database

- [x] Setup backend project (AC: 1, 3)
  - [x] Install dependencies: express, better-sqlite3, multer, cors
  - [x] Create folder structure: routes/, controllers/, database/, middleware/
  - [x] Create backend/src/server.ts entry point
  - [x] Create backend/src/app.ts for Express app configuration
  - [x] Implement health check endpoint `/api/health`
  - [x] Configure CORS for http://localhost:3000

- [x] Setup frontend project (AC: 2, 4)
  - [x] Install dependencies: react, react-dom, react-router-dom, @mui/material, axios
  - [x] Create folder structure: src/components/, src/services/, src/pages/
  - [x] Create frontend/src/App.tsx with basic heading
  - [x] Create API service to call health check endpoint
  - [x] Display connection status in UI

- [x] Initialize SQLite database (AC: 5, 6)
  - [x] Create database initialization script
  - [x] Create documents table with schema from architecture doc
  - [x] Create capas table with schema from architecture doc
  - [x] Create indexes for performance (pillar, category, status)
  - [x] Create triggers for updated_at timestamps
  - [x] Verify database connection in backend startup

- [x] Setup version control (AC: 8)
  - [x] Initialize git repository
  - [x] Create .gitignore: node_modules/, data/*.db, uploads/, dist/, .env

- [x] Create developer documentation (AC: 9)
  - [x] Create README.md with project overview
  - [x] Document prerequisites (Node.js 18+)
  - [x] Document development commands (npm run dev)
  - [x] Document project structure

- [x] Test full stack connectivity (AC: 3, 4, 7)
  - [x] Start backend server on port 5001 (changed from 5000 due to system conflict)
  - [x] Start frontend dev server on port 3000
  - [x] Verify frontend can call backend API
  - [x] Verify CORS headers work correctly

---

## Dev Notes

### Database Schema

**Documents Table:**
```sql
CREATE TABLE IF NOT EXISTS documents (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  filename TEXT NOT NULL,
  original_filename TEXT NOT NULL,
  pillar TEXT NOT NULL CHECK(pillar IN ('pillar-1', 'pillar-2', 'pillar-3', 'pillar-4', 'kpis', 'capa')),
  category TEXT CHECK(category IN ('policies', 'procedures', 'forms', 'evidence') OR category IS NULL),
  file_type TEXT NOT NULL,
  file_size INTEGER NOT NULL CHECK(file_size > 0),
  upload_date TEXT NOT NULL DEFAULT (datetime('now')),
  file_path TEXT NOT NULL UNIQUE,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

CREATE INDEX IF NOT EXISTS idx_documents_pillar ON documents(pillar);
CREATE INDEX IF NOT EXISTS idx_documents_pillar_category ON documents(pillar, category);
CREATE INDEX IF NOT EXISTS idx_documents_upload_date ON documents(upload_date DESC);
```

**CAPAS Table:**
```sql
CREATE TABLE IF NOT EXISTS capas (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  capa_id TEXT NOT NULL UNIQUE,
  description TEXT NOT NULL,
  pillar TEXT CHECK(pillar IN ('pillar-1', 'pillar-2', 'pillar-3', 'pillar-4') OR pillar IS NULL),
  severity TEXT CHECK(severity IN ('critical', 'major', 'minor', 'observation') OR severity IS NULL),
  status TEXT NOT NULL CHECK(status IN ('open', 'in-progress', 'closed')) DEFAULT 'open',
  date_opened TEXT NOT NULL DEFAULT (datetime('now')),
  date_due TEXT,
  date_closed TEXT,
  root_cause TEXT,
  corrective_action TEXT,
  preventive_action TEXT,
  created_at TEXT NOT NULL DEFAULT (datetime('now')),
  updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

CREATE INDEX IF NOT EXISTS idx_capas_status ON capas(status);
CREATE INDEX IF NOT EXISTS idx_capas_pillar ON capas(pillar);
```

### Technology Stack

**Backend:**
- Node.js 18 LTS
- Express 4.18+
- better-sqlite3 9.0+ (for SQLite)
- multer 1.4.5-lts.1 (file uploads)
- cors 2.8.5

**Frontend:**
- React 18.2+
- Vite 5.0+ (build tool)
- Material-UI 5.14+
- React Router 6.20+
- Axios 1.6+

### Project Structure

```
smeta-platform/
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── services/
│   │   ├── pages/
│   │   └── App.tsx
│   ├── package.json
│   └── vite.config.ts
├── backend/
│   ├── src/
│   │   ├── routes/
│   │   ├── controllers/
│   │   ├── database/
│   │   ├── middleware/
│   │   ├── app.ts
│   │   └── server.ts
│   └── package.json
├── data/
│   └── smeta.db (gitignored)
├── package.json (workspace root)
└── README.md
```

### README Template Contents

The README.md should include:
1. **Project Overview** - Brief description of SMETA Compliance Platform
2. **Prerequisites** - Node.js 18+ required
3. **Development Setup** - Installation instructions
4. **Development Commands:**
   - `npm run dev` - Start both frontend and backend
   - `npm run dev:frontend` - Start frontend only (port 3000)
   - `npm run dev:backend` - Start backend only (port 5000)
5. **Project Structure** - Monorepo layout explanation
6. **Technology Stack** - List of main technologies

### Environment Configuration

**Backend .env:**
```
NODE_ENV=development
PORT=5000
DB_PATH=../data/smeta.db
UPLOAD_DIR=./uploads
CORS_ORIGIN=http://localhost:3000
```

**Frontend .env:**
```
VITE_API_URL=http://localhost:5000/api
VITE_APP_NAME="SMETA Compliance Platform"
```

---

## Testing

### Manual Testing Checklist

1. Start backend: `cd backend && npm run dev`
2. Verify backend responds: `curl http://localhost:5000/api/health`
3. Start frontend: `cd frontend && npm run dev`
4. Open browser to http://localhost:3000
5. Verify "SMETA Platform" heading displays
6. Verify connection status shows "Connected" (health check successful)
7. Check browser console for no errors
8. Check backend console for successful database connection
9. Verify SQLite database file exists at `data/smeta.db`
10. Verify git repository initialized with proper .gitignore

### Testing Standards

- **Manual testing** - No automated tests required for MVP
- **Error handling** - All try/catch blocks should log errors to console
- **Console logging** - Use descriptive log messages for debugging
- **Database verification** - Check database file exists and tables created

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| Oct 28, 2025 | 1.0 | Story created from PRD | Sarah (PO) |
| Oct 28, 2025 | 1.1 | Story implemented - Full stack setup complete, backend on port 5001 | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (via OpenCode)

### Implementation Summary

Successfully implemented full-stack project setup with monorepo structure, backend API, frontend React app, and SQLite database.

### Key Implementation Details

**Port Configuration Change:**
- Changed backend port from 5000 to 5001 due to system service conflict (ControlCenter occupying port 5000)
- Updated all configuration files and documentation accordingly

**Database:**
- SQLite database created at `data/smeta.db`
- Both tables (`documents` and `capas`) created with full schema
- Indexes and triggers implemented as specified
- Database initialization runs automatically on backend startup

**Backend:**
- TypeScript + Express + better-sqlite3 v11.0.0 (upgraded from 9.0.0 for Node.js 24 compatibility)
- Health check endpoint responding in ~19ms (well under 100ms requirement)
- CORS properly configured for frontend origin
- Graceful shutdown handlers implemented

**Frontend:**
- React 18 + TypeScript + Vite + Material-UI
- Health check integration working correctly
- Connection status display functional
- Clean UI with loading states and error handling

### File List

**Root:**
- `package.json` - Workspace configuration
- `package-lock.json` - Dependency lock file
- `.gitignore` - Git ignore rules
- `README.md` - Developer documentation

**Backend (`backend/`):**
- `package.json` - Backend dependencies
- `tsconfig.json` - TypeScript configuration
- `.env` - Environment variables (PORT=5001)
- `src/server.ts` - Server entry point
- `src/app.ts` - Express app configuration
- `src/database/db.ts` - Database initialization and connection
- `src/controllers/healthController.ts` - Health check handler
- `src/routes/health.ts` - Health check route

**Frontend (`frontend/`):**
- `package.json` - Frontend dependencies
- `tsconfig.json` - TypeScript configuration
- `tsconfig.node.json` - Node TypeScript configuration
- `vite.config.ts` - Vite configuration with proxy
- `.env` - Environment variables (API URL)
- `index.html` - HTML entry point
- `src/main.tsx` - React entry point
- `src/App.tsx` - Main app component with health check
- `src/services/api.ts` - Axios API client with health check function

**Data:**
- `data/smeta.db` - SQLite database file (gitignored)

### Debug Log References
None - No blocking issues encountered after resolving initial better-sqlite3 version compatibility.

### Completion Notes

**All Acceptance Criteria Met:**
1. ✅ Backend project structure complete with all required folders
2. ✅ Frontend project structure complete with all required folders
3. ✅ Health check endpoint returns `{status: 'ok'}` in ~19ms
4. ✅ Frontend displays "SMETA Platform" heading and connection status
5. ✅ SQLite database created and verified at `data/smeta.db`
6. ✅ Database schema complete with documents and capas tables, indexes, and triggers
7. ✅ Backend on port 5001 (adjusted), frontend on port 3000, CORS working
8. ✅ Git repository initialized with comprehensive .gitignore
9. ✅ README.md complete with all required documentation

**Technical Decisions:**
- Used better-sqlite3 v11 instead of v9 for Node.js 24 compatibility
- Backend port changed to 5001 due to system service on port 5000
- Added TypeScript strict mode for better type safety
- Implemented graceful shutdown handlers for clean process termination
- Added request logging middleware for debugging

**Known Issues/Limitations:**
- No automated tests (as specified in story - manual testing only for MVP)
- Multer dependency has security advisories (acceptable for MVP, should upgrade to v2.x in future)

**Ready for QA Review**

---

## QA Results

*(To be populated after QA review)*
